<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Litiaina N1</title>
    <link rel="icon" type="image/png" href="images/litiaina_icon_48x48.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* CRITICAL CSS: Runs immediately to prevent raw HTML flash */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000; /* True Black */
            color: white;
            font-family: 'Segoe UI', 'Inter', sans-serif;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-tap-highlight-color: transparent;
        }

        /* Pure CSS Boot Screen */
        #boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000; 
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        /* Cloak Main Content Initially */
        #main-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s cubic-bezier(0.2, 0.8, 0.2, 1), transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        #main-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Theme Variables --- */
        :root {
            --glass-bg: rgba(0, 0, 0, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent-color: #60cdff;
            --accent-glow: rgba(96, 205, 255, 0.4);
            --text-primary: #ffffff;
        }

        /* Wallpaper Background */
        #wallpaper {
            position: fixed;
            inset: 0;
            /* Ensure visibility over body background */
            z-index: 0;
            /* Neutral Dark Gradient Fallback */
            background: radial-gradient(circle at top right, #1a1a1a, #000000);
            /* Local Image Path */
            background-image: url('images/n1-cloud-professional-wallpaper.jpg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: transform 0.6s ease, filter 0.6s ease;
        }

        #wallpaper::after {
            content: '';
            position: absolute;
            inset: 0;
            /* Neutral Black Overlay */
            background: rgba(0, 0, 0, 0.6); 
            backdrop-filter: blur(0px);
        }

        /* --- Components --- */

        .n1-input {
            width: 100%;
            /* Neutral dark glass */
            background-color: rgba(0, 0, 0, 0.6); 
            border: 1px solid var(--glass-border);
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 16px; 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }

        .n1-input::placeholder { color: rgba(255, 255, 255, 0.5); }

        .n1-input:focus {
            background-color: rgba(0, 0, 0, 0.8);
            border-color: rgba(255, 255, 255, 0.4);
            border-bottom-color: var(--accent-color);
            outline: none;
            transform: translateY(-1px);
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .glass-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(96, 205, 255, 0.2);
        }

        .glass-btn:active { transform: scale(0.98); }

        .profile-container {
            position: relative;
            border-radius: 50%;
            padding: 4px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease;
        }
        .profile-container:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.3); }

        .custom-checkbox {
            appearance: none;
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 3px;
            width: 16px; height: 16px;
            display: grid; place-content: center;
            cursor: pointer;
        }
        .custom-checkbox::before {
            content: "\2713"; font-size: 10px; color: black; font-weight: 800;
            transform: scale(0); transition: 0.1s;
        }
        .custom-checkbox:checked { background-color: var(--accent-color); border-color: var(--accent-color); }
        .custom-checkbox:checked::before { transform: scale(1); }

        .dots-loader { display: flex; gap: 6px; }
        .dots-loader .dot {
            width: 8px; height: 8px; background: white; border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0s; }
        .dot:nth-child(4) { animation-delay: 0.16s; }
        .dot:nth-child(5) { animation-delay: 0.32s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); opacity: 0; } 40% { transform: scale(1); opacity: 1; } }
    </style>
</head>

<body>

    <!-- Background -->
    <div id="wallpaper"></div>

    <!-- Boot Screen -->
    <div id="boot-screen">
        <img src="images/litiaina_icon_48x48.png" alt="logo" style="width: 64px; height: 64px; margin-bottom: 32px; opacity: 0.9;" />
        <div class="dots-loader">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black/80 z-[8000] flex flex-col items-center justify-center backdrop-blur-md transition-all duration-300">
        <div class="w-10 h-10 border-2 border-t-transparent border-[#60cdff] rounded-full animate-spin mb-4"></div>
        <h2 class="text-lg font-light tracking-wide text-white">Loading...</h2>
    </div>

    <!-- Main Container -->
    <main id="main-content" class="relative z-10 w-full min-h-screen flex flex-col items-center justify-center p-6">

        <!-- Clock Section -->
        <div id="clock-container" class="w-full flex flex-col items-center select-none text-center mb-8 md:mb-12 transition-all duration-300">
            <div id="clock-time" class="text-6xl sm:text-7xl md:text-8xl lg:text-9xl leading-none font-light tracking-tight text-white font-[Segoe UI Light] drop-shadow-lg">
                12:00
            </div>
            <div id="clock-date" class="text-lg sm:text-xl md:text-2xl font-normal text-white/80 mt-2 drop-shadow-md">
                Wednesday, December 17
            </div>
        </div>

        <!-- Login Card -->
        <div id="loginContainer" class="w-full max-w-sm flex flex-col items-center">
            
            <!-- User Profile -->
            <div class="flex flex-col items-center mb-6 w-full group">
                <div class="profile-container mb-4 w-24 h-24 sm:w-32 sm:h-32">
                    <div class="w-full h-full rounded-full bg-[#333] overflow-hidden relative shadow-2xl">
                        <!-- Path to User Image -->
                        <img src="images/litiaina_icon.png" 
                                onerror="this.src='https://placehold.co/150x150/333/FFF?text=User'" 
                                class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity">
                    </div>
                </div>
                <h1 class="text-xl sm:text-2xl font-semibold text-white tracking-wide mb-1 drop-shadow-md">N1</h1>
                <p id="auth-status-text" class="text-sm text-gray-300 font-light min-h-[1.25rem]">Locked</p>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="w-full space-y-4">
                
                <div class="space-y-3">
                    <input type="email" id="loginEmail" placeholder="Email" required class="n1-input" autocomplete="email" />
                    <input type="password" id="loginPassword" placeholder="Password" required class="n1-input" autocomplete="current-password" />
                    
                    <div class="hidden" id="otpGroup">
                        <input type="text" id="loginOtp" placeholder="Code" maxlength="6" class="n1-input text-center tracking-[0.5em] font-mono" />
                    </div>
                </div>

                <button type="submit" id="authBtn" class="glass-btn w-full mt-2 text-white font-medium py-3 rounded-md backdrop-blur-sm flex items-center justify-center gap-2">
                    <span id="btnText">Sign In</span>
                    <i id="btnSpinner" class="fas fa-circle-notch fa-spin hidden"></i>
                </button>

                <div class="flex flex-row justify-between items-center text-xs mt-6 px-1 text-gray-400">
                    <label class="flex items-center hover:text-white cursor-pointer transition-colors gap-2 select-none">
                        <input type="checkbox" id="rememberMe" class="custom-checkbox"> 
                        <span>Keep me signed in</span>
                    </label>
                    <span id="forgotPassword" class="hover:text-[#60cdff] cursor-pointer transition-colors">Forgot password?</span>
                </div>
            </form>
            
            <div class="mt-8 mb-4">
                <button type="button" id="signup" class="text-sm text-gray-500 hover:text-white transition-colors">
                    Create a new account
                </button>
            </div>
        </div>

    </main>

    <!-- Modal -->
    <div id="modalContainer" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[9000] hidden opacity-0 transition-all duration-300">
        <div id="modal" class="bg-[#1f1f1f] border border-white/10 rounded-lg shadow-2xl max-w-sm w-full transform scale-95 transition-all duration-300">
            <div class="p-6">
                <h3 id="modalTitle" class="text-lg font-semibold text-white mb-2">Notification</h3>
                <p id="modalMessage" class="text-sm text-gray-300 leading-relaxed">Message content.</p>
            </div>
            <div class="bg-[#252525] p-4 flex justify-end rounded-b-lg">
                <button id="modalCloseBtn" class="bg-white/10 hover:bg-white/20 text-white py-1.5 px-4 rounded text-sm transition-colors border border-white/5">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const serverLink = `https://api.litiaina.com`;
            
            // DOM Elements
            const bootScreen = document.getElementById('boot-screen');
            const mainContent = document.getElementById('main-content');
            const loginForm = document.getElementById('loginForm');
            const otpGroup = document.getElementById('otpGroup');
            const otpInput = document.getElementById('loginOtp');
            const authBtn = document.getElementById('authBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            const authStatusText = document.getElementById('auth-status-text');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const wallpaper = document.getElementById('wallpaper');
            const clockContainer = document.getElementById('clock-container');
            const loginContainer = document.getElementById('loginContainer');
            
            // Boot Sequence
            window.addEventListener('load', () => {
                setTimeout(() => {
                    bootScreen.style.opacity = '0';
                    bootScreen.style.visibility = 'hidden';
                    setTimeout(() => {
                        mainContent.classList.add('visible');
                        setTimeout(() => bootScreen.remove(), 800);
                    }, 200);
                }, 800); 
            });

            // Clock Logic
            const updateClock = () => {
                const now = new Date();
                document.getElementById('clock-time').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
                const options = { weekday: 'long', month: 'long', day: 'numeric' };
                document.getElementById('clock-date').textContent = now.toLocaleDateString(undefined, options);
            };
            setInterval(updateClock, 1000);
            updateClock();

            // UI Helpers
            const setLoading = (isLoading) => {
                authBtn.disabled = isLoading;
                if (isLoading) {
                    btnText.classList.add('hidden');
                    btnSpinner.classList.remove('hidden');
                    authStatusText.textContent = "Verifying...";
                } else {
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                    authStatusText.textContent = "Locked";
                }
            };

            const showModal = (title, message, isError = true) => {
                const titleEl = document.getElementById('modalTitle');
                titleEl.textContent = title;
                titleEl.className = isError ? "text-lg font-semibold text-red-400 mb-2" : "text-lg font-semibold text-white mb-2";
                document.getElementById('modalMessage').textContent = message;
                const c = document.getElementById('modalContainer');
                const m = document.getElementById('modal');
                c.classList.remove('hidden');
                void c.offsetWidth;
                c.classList.remove('opacity-0');
                m.classList.remove('scale-95');
                m.classList.add('scale-100');
            };

            const hideModal = () => {
                const c = document.getElementById('modalContainer');
                const m = document.getElementById('modal');
                c.classList.add('opacity-0');
                m.classList.add('scale-95');
                m.classList.remove('scale-100');
                setTimeout(() => c.classList.add('hidden'), 300);
            };
            document.getElementById('modalCloseBtn').onclick = hideModal;

            // Focus Effects
            const inputs = document.querySelectorAll('.n1-input');
            inputs.forEach(input => {
                input.addEventListener('focus', () => {
                    wallpaper.style.filter = "blur(5px)";
                    wallpaper.style.transform = "scale(1.02)";
                    if(window.innerHeight > 600) { 
                        clockContainer.style.opacity = "0.5";
                        clockContainer.style.transform = "translateY(-10px)";
                    }
                });
                input.addEventListener('blur', () => {
                    setTimeout(() => {
                        if(!document.activeElement.classList.contains('n1-input')) {
                            wallpaper.style.filter = "blur(0px)";
                            wallpaper.style.transform = "scale(1)";
                            clockContainer.style.opacity = "1";
                            clockContainer.style.transform = "translateY(0)";
                        }
                    }, 100);
                });
            });

            // Navigation - Signup
            document.getElementById("signup").onclick = () => {
                mainContent.style.opacity = '0';
                mainContent.style.transform = 'translateY(20px)';
                // PATH FIX: signup is a folder
                setTimeout(() => window.location.href = "signup/", 400); 
            };

            // Session Check
            const checkSession = async () => {
                const token = localStorage.getItem("current-token");
                const isRemembered = localStorage.getItem("remember-me");
                
                if (token && isRemembered === "true") {
                    mainContent.style.display = 'none'; 
                    loadingOverlay.classList.remove('hidden');
                    
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 8000); 

                        const response = await fetch(`${serverLink}/auth/check`, {
                            method: 'GET',
                            headers: { 'Authorization': `Bearer ${token}` },
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        const result = await response.json();

                        if (response.ok && result.valid === "true") {
                            // PATH FIX: n1 is a folder
                            setTimeout(() => window.location.href = "n1/", 800);
                        } else {
                            throw new Error("Expired");
                        }
                    } catch (e) {
                        loadingOverlay.classList.add('hidden');
                        mainContent.style.display = 'flex';
                        localStorage.removeItem("current-token");
                    }
                }
            };
            await checkSession();

            // Login Logic
            loginForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                setLoading(true);

                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                const otp = otpInput.value.trim();
                const rememberMe = document.getElementById('rememberMe').checked;

                if (!email || !password) {
                    showModal("Attention", "Please enter both your email and password.");
                    setLoading(false);
                    return;
                }

                try {
                    let otpRequired = false;
                    try {
                        const checkRes = await fetch(`${serverLink}/auth/account/2fa`, {
                            method: 'POST',
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ email, password })
                        });
                        if (checkRes.ok) {
                            const result = await checkRes.json();
                            otpRequired = result.enabled === true;
                        }
                    } catch (e) { console.warn("2FA check skipped", e); }

                    if (otpRequired) {
                        otpGroup.classList.remove('hidden');
                        otpGroup.style.display = 'block'; 
                        
                        if (!otp) {
                            showModal("Security Verification", "This account is protected by 2FA. Please enter your code.", false);
                            otpInput.focus();
                            setLoading(false);
                            return;
                        }
                    }

                    const loginRes = await fetch(`${serverLink}/auth/login`, {
                        method: 'POST',
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ email, password, otp: otp || "" })
                    });

                    const loginResult = await loginRes.json();

                    if (!loginRes.ok || !loginResult.response) {
                        throw new Error(loginResult.message || "Incorrect email or password.");
                    }

                    const token = loginResult.token;
                    
                    const accRes = await fetch(`${serverLink}/auth/account`, {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json",
                            "authorization": `Bearer ${token}`,
                        },
                        body: JSON.stringify({ email })
                    });

                    if (!accRes.ok) throw new Error("Failed to retrieve user profile.");

                    const accountDetails = await accRes.json();

                    localStorage.setItem("current-account-email", email);
                    localStorage.setItem("current-token", token);
                    localStorage.setItem("current-account-uid", accountDetails.uid);
                    localStorage.setItem("current-account-name", accountDetails.name);
                    localStorage.setItem("current-capacity", accountDetails.allocated_storage);

                    if (rememberMe) {
                        localStorage.setItem("remember-me", "true");
                    } else {
                        localStorage.removeItem("remember-me");
                    }

                    authStatusText.textContent = `Welcome, ${accountDetails.name}`;
                    authStatusText.classList.add('text-green-400');
                    
                    loadingOverlay.classList.remove('hidden');
                    
                    mainContent.style.opacity = '0';
                    mainContent.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        // PATH FIX: n1 is a folder
                        window.location.href = "n1/";
                    }, 1000);

                } catch (err) {
                    showModal("Login Failed", err.message);
                    setLoading(false);
                }
            });
        });
    </script>
</body>
</html>